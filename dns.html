<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HTTPDNS/DNS ç»Ÿä¸€éªŒè¯å·¥å…·</title>
    <style>
        :root {
            --primary: #2563eb;
            --danger: #ef4444;
            --success: #22c55e;
            --bg: #f8fafc;
            --card: #ffffff;
            --border: #e2e8f0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: var(--bg);
            color: #334155;
            margin: 0;
            line-height: 1.5;
        }

        /* --- Navbar --- */
        .navbar { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); border-bottom: 1px solid var(--border); position: sticky; top: 0; z-index: 1000; }
        .nav-container { max-width: 1200px; margin: 0 auto; height: 60px; padding: 0 20px; display: flex; justify-content: space-between; align-items: center; }
        .nav-logo { font-weight: 700; font-size: 1.15rem; color: var(--primary); text-decoration: none; }
        .nav-links { display: flex; gap: 20px; }
        .nav-link { text-decoration: none; color: #64748b; font-weight: 500; font-size: 0.9rem; transition: color 0.2s; }
        .nav-link:hover { color: var(--primary); }
        .nav-link.active { color: var(--primary); font-weight: 600; }
        @media (max-width: 768px) { .nav-links { display: none; } }

        .container { max-width: 1000px; margin: 30px auto; padding: 0 20px; }
        h1 { color: #1e293b; text-align: center; margin-bottom: 20px; }
        h2 { font-size: 1.1rem; margin-top: 0; padding-bottom: 10px; border-bottom: 2px solid #f1f5f9; }

        .card { background: var(--card); padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); margin-bottom: 20px; }

        .query-box-top { display: flex; gap: 10px; margin-bottom: 15px; align-items: flex-end; }
        .input-group { width: 100%; }
        .domain-group { flex-grow: 1; } 
        .input-group label { display: block; font-size: 0.9em; font-weight: 600; margin-bottom: 5px; color: #475569; }

        input[type="text"] { width: 100%; padding: 10px 12px; border: 1px solid var(--border); border-radius: 6px; font-size: 14px; box-sizing: border-box; }
        .btn { padding: 10px 20px; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; white-space: nowrap; height: 40px; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { background: #1d4ed8; }
        .btn-primary:disabled { background: #94a3b8; cursor: not-allowed; }

        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th { text-align: left; padding: 12px; background: #f8fafc; color: #64748b; font-size: 0.9em; }
        td { padding: 12px; border-top: 1px solid var(--border); vertical-align: middle; }
        .status-badge { display: inline-flex; align-items: center; padding: 4px 8px; border-radius: 99px; font-size: 12px; font-weight: 600; }
        .st-ok { background: #dcfce7; color: #15803d; }
        .st-err { background: #fee2e2; color: #b91c1c; }
        .st-wait { background: #f1f5f9; color: #64748b; }
        .tips { font-size: 0.9em; color: #64748b; background: #fff7ed; padding: 15px; border-radius: 8px; border-left: 4px solid #f97316; margin-bottom: 20px; }
    </style>
</head>
<body>

<nav class="navbar">
    <div class="nav-container">
        <a href="index.html" class="nav-logo">ğŸ›¡ï¸ å®‰å…¨å·¥å…·ç®±</a>
        <div class="nav-links">
            <a href="index.html" class="nav-link">é¦–é¡µ</a>
            <a href="watermark.html" class="nav-link">åœ¨çº¿æ°´å°</a>
            <a href="dns.html" class="nav-link active">DNSæŸ¥è¯¢</a>
            <a href="jasonformat.html" class="nav-link">JSONå·¥å…·</a>
            <a href="base64.html" class="nav-link">Base64</a>
        </div>
    </div>
</nav>

<div class="container">
    <h1>HTTPDNS/DNS ç»Ÿä¸€éªŒè¯å·¥å…·</h1>

    <div class="card">
        <div class="query-box-top">
            <div class="input-group domain-group">
                <label for="domainInput">æŸ¥è¯¢åŸŸå (æ”¯æŒ IP è‡ªåŠ¨è½¬æ¢ HTTPDNS)</label>
                <input type="text" id="domainInput" value="www.google.com" placeholder="è¯·è¾“å…¥åŸŸå">
            </div>
            <button class="btn btn-primary" id="queryBtn" onclick="startQuery()">ğŸš€ å¼€å§‹æŸ¥è¯¢</button>
        </div>
        <div id="customServerWrapper" style="display: none; margin-top: 10px;">
            <div class="input-group">
                <label>è‡ªå®šä¹‰ DNS/DoH æœåŠ¡å™¨ (é€‰å¡«)</label>
                <input type="text" id="customServerInput" placeholder="ä¾‹å¦‚: 8.8.8.8 æˆ– https://dns.alidns.com/resolve">
            </div>
        </div>
    </div>
    
    <div class="tips">
        <strong>âš ï¸ æç¤ºï¼š</strong> æµè§ˆå™¨é™åˆ¶äº†åŸç”Ÿ UDP/DNS è°ƒç”¨ã€‚è¾“å…¥ **IP åœ°å€** æ—¶ï¼Œå·¥å…·ä¼šè‡ªåŠ¨è½¬æ¢ä¸ºæ ‡å‡†çš„ `https://IP/dns-query` æ ¼å¼è¿›è¡Œæµ‹è¯•ã€‚å†…ç½®åˆ—è¡¨åŒ…å« Google, Cloudflare å’Œ AliDNSã€‚
    </div>

    <div class="card">
        <h2>æŸ¥è¯¢ç»“æœ</h2>
        <table id="resultTable">
            <thead>
                <tr>
                    <th style="width: 45%">æœåŠ¡å™¨åœ°å€</th>
                    <th style="width: 15%">çŠ¶æ€</th>
                    <th style="width: 40%">è§£æç»“æœ / è€—æ—¶</th>
                </tr>
            </thead>
            <tbody id="resultBody">
                <tr><td colspan="3" style="text-align:center; color:#94a3b8; padding: 20px;">æš‚æ— æ•°æ®ï¼Œè¯·ç‚¹å‡»å¼€å§‹æŸ¥è¯¢</td></tr>
            </tbody>
        </table>
    </div>
</div>

<script>
    const DEFAULT_SERVERS = [
        'https://dns.google/resolve', 
        'https://cloudflare-dns.com/dns-query', 
        'https://dns.alidns.com/resolve'
    ];
    const IPV4_REGEX = /^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/;

    window.onload = function() {
        const domainInput = document.getElementById('domainInput');
        domainInput.addEventListener('focus', () => document.getElementById('customServerWrapper').style.display = 'block');
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') startQuery();
        });
    }

    function prepareServers() {
        const customVal = document.getElementById('customServerInput').value.trim();
        let servers = [...DEFAULT_SERVERS];
        if (customVal) {
            if (IPV4_REGEX.test(customVal)) servers.push(`https://${customVal}/dns-query`);
            else if (!customVal.startsWith('http')) servers.push(`https://${customVal}`);
            else servers.push(customVal);
        }
        return [...new Set(servers)];
    }

    async function startQuery() {
        const domain = document.getElementById('domainInput').value.trim();
        if (!domain) return alert('è¯·è¾“å…¥åŸŸå');

        const btn = document.getElementById('queryBtn');
        const tbody = document.getElementById('resultBody');
        btn.disabled = true;
        btn.innerHTML = 'æŸ¥è¯¢ä¸­...';
        tbody.innerHTML = '';

        const servers = prepareServers();
        servers.forEach((s, i) => {
            const tr = document.createElement('tr');
            tr.id = `row-${i}`;
            tr.innerHTML = `<td>${s}</td><td><span class="status-badge st-wait">Pending</span></td><td>-</td>`;
            tbody.appendChild(tr);
        });

        await Promise.all(servers.map((s, i) => doFetch(s, domain, i)));
        btn.disabled = false;
        btn.innerHTML = 'ğŸš€ å¼€å§‹æŸ¥è¯¢';
    }

    async function doFetch(urlStr, domain, idx) {
        const row = document.getElementById(`row-${idx}`);
        const statusCell = row.cells[1];
        const resCell = row.cells[2];
        const start = performance.now();

        try {
            const u = new URL(urlStr);
            u.searchParams.set('name', domain);
            u.searchParams.set('type', 'A');
            
            const res = await fetch(u.toString(), { headers: { 'Accept': 'application/dns-json' } });
            const data = await res.json();
            const time = Math.round(performance.now() - start);

            if (data.Answer) {
                statusCell.innerHTML = `<span class="status-badge st-ok">Success</span>`;
                const ips = data.Answer.filter(r => r.type === 1).map(r => r.data).join(', ');
                resCell.innerHTML = `<strong>${ips || 'æ— Aè®°å½•'}</strong> <span style="font-size:0.8em;color:#999">(${time}ms)</span>`;
            } else {
                statusCell.innerHTML = `<span class="status-badge st-ok">No Answer</span>`;
                resCell.textContent = `Status: ${data.Status} (${time}ms)`;
            }
        } catch (e) {
            statusCell.innerHTML = `<span class="status-badge st-err">Error</span>`;
            resCell.innerHTML = `<span style="color:#b91c1c;font-size:0.9em">${e.message}</span>`;
        }
    }
</script>
</body>
</html>
