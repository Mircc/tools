<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RSA åŠ å¯†è§£å¯†å·¥å…· - Web Crypto</title>
    <style>
        :root {
            --primary: #2563eb;
            --primary-hover: #1d4ed8;
            --bg: #f8fafc;
            --card: #ffffff;
            --border: #e2e8f0;
            --text-main: #1e293b;
            --text-sub: #64748b;
            --radius: 12px;
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: var(--bg);
            color: var(--text-main);
            margin: 0;
            padding: 20px;
            line-height: 1.6;
        }

        .container { max-width: 900px; margin: 0 auto; }
        
        h1 { color: var(--text-main); text-align: center; margin-bottom: 20px; font-size: 2rem; }
        h3 { font-size: 1.1rem; color: var(--primary); margin-top: 15px; margin-bottom: 10px; }

        .card {
            background: var(--card);
            padding: 30px;
            border-radius: var(--radius);
            box-shadow: var(--shadow-lg);
            margin-bottom: 30px;
        }
        
        /* Layout */
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 20px;}

        /* Input Styles */
        .input-group { margin-bottom: 20px; }
        label { display: block; font-weight: 600; font-size: 0.9em; margin-bottom: 8px; color: var(--text-sub); }

        input[type="text"], select, textarea {
            width: 100%; padding: 10px 12px; border: 1px solid var(--border); border-radius: 8px;
            font-size: 14px; box-sizing: border-box; background: #fff; color: var(--text-main);
            font-family: monospace; resize: vertical; min-height: 40px;
        }
        textarea { min-height: 100px; }
        input[type="text"]:focus, select:focus, textarea:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1); }

        /* Buttons */
        .btn { padding: 10px 20px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.2s; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { background: var(--primary-hover); }
        .btn-danger { background: #ef4444; color: white; }
        .btn:disabled { opacity: 0.6; cursor: not-allowed; }

        /* Status and Results */
        #mainActionBtn { padding: 12px 20px; font-size: 1.1rem; width: 100%; }

        .status-message { min-height: 1.5em; margin-top: 10px; font-size: 0.9em; color: #ef4444; }
        #keyGenerationStatus { min-height: 1.5em; margin-top: 10px; font-size: 0.9em; color: #22c55e; }
        
        .result-box {
            background: #f1f5f9; padding: 15px; border-radius: 8px; margin-top: 15px;
            font-family: monospace; font-size: 0.9em; min-height: 80px; word-break: break-all;
        }

        .alert-box {
            background: #fffbe7; color: #92400e; padding: 10px; border-radius: 8px; margin-bottom: 15px;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>RSA åŠ å¯†/è§£å¯†å·¥å…·</h1>
    
    <div class="alert-box">
        âš ï¸ **é‡è¦æç¤ºï¼š** RSA åŠ å¯†æœ‰æ•°æ®é•¿åº¦é™åˆ¶ï¼ˆé€šå¸¸ä¸ºå¯†é’¥é•¿åº¦å‡å» 42 å­—èŠ‚ï¼‰ã€‚åŠ å¯†æ•°æ®è¿‡é•¿ä¼šå¯¼è‡´å¤±è´¥ã€‚
    </div>

    <div class="card">
        <h2>å¯†é’¥ç”Ÿæˆ (Web Crypto API)</h2>
        
        <div class="grid-3">
            <div class="input-group">
                <label for="keySize">å¯†é’¥ä½æ•°</label>
                <select id="keySize">
                    <option value="2048" selected>2048 bits (æ¨è)</option>
                    <option value="3072">3072 bits</option>
                    <option value="4096">4096 bits</option>
                </select>
            </div>
            <div class="input-group">
                <label for="keyFormat">ç§é’¥æ ¼å¼</label>
                <select id="keyFormat">
                    <option value="pkcs8" selected>PKCS#8 (æ¨è)</option>
                    <option value="pkcs1">PKCS#1 (ä¸æ”¯æŒåŸç”Ÿå¯¼å‡º)</option>
                </select>
            </div>
            <div class="input-group" style="padding-top: 25px;">
                <button id="generateKeyBtn" class="btn btn-primary">ğŸ”‘ ç”Ÿæˆå¯†é’¥å¯¹</button>
            </div>
        </div>
        
        <div id="keyGenerationStatus" style="color:#22c55e;"></div>

        <div class="grid-2">
            <div class="input-group">
                <label for="publicKeyOutput">å…¬é’¥ (SPKI PEM)</label>
                <textarea id="publicKeyOutput" placeholder="ç”Ÿæˆçš„å…¬é’¥å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ..." readonly></textarea>
            </div>
            <div class="input-group">
                <label for="privateKeyOutput">ç§é’¥ (PKCS#8 PEM)</label>
                <textarea id="privateKeyOutput" placeholder="ç”Ÿæˆçš„ç§é’¥å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ..." readonly></textarea>
            </div>
        </div>
    </div>

    <div class="card">
        <h2>æ•°æ®å¤„ç† (RSA-OAEP)</h2>

        <div class="grid-2">
            <div class="input-group">
                <label for="inputPublicKey">è¾“å…¥å…¬é’¥ (Encrypt)</label>
                <textarea id="inputPublicKey" placeholder="ç”¨äºåŠ å¯†ï¼Œå¯ä»ä¸Šæ–¹å¤åˆ¶"></textarea>
            </div>
            <div class="input-group">
                <label for="inputPrivateKey">è¾“å…¥ç§é’¥ (Decrypt)</label>
                <textarea id="inputPrivateKey" placeholder="ç”¨äºè§£å¯†ï¼Œå¯ä»ä¸Šæ–¹å¤åˆ¶"></textarea>
            </div>
        </div>

        <div class="input-group">
            <label for="contentInput">è¾“å…¥å†…å®¹ (æ˜æ–‡æˆ–å¯†æ–‡)</label>
            <textarea id="contentInput" placeholder="è¾“å…¥æ˜æ–‡è¿›è¡ŒåŠ å¯†ï¼Œæˆ–ç²˜è´´å¯†æ–‡è¿›è¡Œè§£å¯†..."></textarea>
        </div>
        
        <button id="mainActionBtn" class="btn btn-primary">ğŸ”’ åŠ å¯†</button>
        
        <div id="actionStatus" class="status-message"></div>

        <div class="input-group">
            <label for="resultOutput">å¤„ç†ç»“æœ (åŒå‡»å¤åˆ¶)</label>
            <textarea id="resultOutput" class="result-box" readonly title="åŒå‡»è‡ªåŠ¨å¤åˆ¶ç»“æœ"></textarea>
        </div>

    </div>
</div>

<script>
    // --- å¸¸é‡ ---
    const RSA_ALGORITHM = 'RSA-OAEP';
    const HASH_ALGORITHM = 'SHA-256';
    const MAX_PLAINTEXT_LENGTH_BYTES = 200; // é¢„ä¼°çš„æœ€å¤§å®‰å…¨æ˜æ–‡é•¿åº¦ï¼Œç”¨äºæç¤ºç”¨æˆ·

    // --- DOM å…ƒç´  ---
    const keySize = document.getElementById('keySize');
    const keyFormat = document.getElementById('keyFormat');
    const generateKeyBtn = document.getElementById('generateKeyBtn');
    const publicKeyOutput = document.getElementById('publicKeyOutput');
    const privateKeyOutput = document.getElementById('privateKeyOutput');
    const keyGenerationStatus = document.getElementById('keyGenerationStatus');

    const inputPublicKey = document.getElementById('inputPublicKey');
    const inputPrivateKey = document.getElementById('inputPrivateKey');
    const contentInput = document.getElementById('contentInput');
    const mainActionBtn = document.getElementById('mainActionBtn');
    const resultOutput = document.getElementById('resultOutput');
    const actionStatus = document.getElementById('actionStatus');

    // --- å·¥å…·å‡½æ•° ---

    // ArrayBuffer to Base64 (needed for PEM)
    const arrayBufferToBase64 = (buffer) => btoa(String.fromCharCode(...new Uint8Array(buffer)));
    
    // Base64 to ArrayBuffer
    const base64ToArrayBuffer = (base64) => {
        const binary = atob(base64);
        const bytes = new Uint8Array(binary.length);
        for (let i = 0; i < binary.length; i++) {
            bytes[i] = binary.charCodeAt(i);
        }
        return bytes.buffer;
    };
    
    // Array
